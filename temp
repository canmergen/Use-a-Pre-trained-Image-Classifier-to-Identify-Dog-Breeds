import pandas as pd
import numpy as np

def fill_column_if_constant(df: pd.DataFrame, col: str = "tarih") -> pd.DataFrame:
    """
    Bir sütundaki None/NaN/boş değerleri,
    - Eğer sütundaki diğer tüm dolu değerler aynıysa, bu ortak değerle doldurur.
    - Farklı değerler varsa hiçbir şey yapmaz.

    Boş sayılanlar: None, NaN, '', 'nan', 'None', 'none'
    """
    out = df.copy()

    if col not in out.columns:
        return out

    s_raw = out[col]

    # string normalize
    s_str = s_raw.astype(str).str.strip()

    # boş olanlar
    missing_mask = (
        s_raw.isna() |
        s_str.str.lower().isin(["", "nan", "none"])
    )

    # dolu olanlar (normalize edilmiş string olarak)
    non_missing = s_str[~missing_mask]

    # dolu unique değerler
    uniq_vals = non_missing.unique()

    # Eğer hiç dolu değer yoksa veya birden fazla farklı değer varsa → dokunma
    if len(uniq_vals) != 1:
        return out

    # Ortak değer (orijinal formatı korumak için raw'dan al)
    common_raw = s_raw[~missing_mask].iloc[0]

    # Sadece boş olan yerlere bu değeri yaz
    out.loc[missing_mask, col] = common_raw

    # İstersen kalan NaN/None/boşları normalize etmek için:
    # out[col] = out[col].apply(
    #     lambda x: None if (x is None or (isinstance(x, float) and np.isnan(x)) or str(x).strip().lower() in ["", "nan", "none"])
    #     else x
    # )

    return out

df = fill_column_if_constant(df, col="tarih")